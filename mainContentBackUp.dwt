<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<!-- TemplateBeginEditable name="doctitle" -->
<title>Untitled Document</title>
<!-- TemplateEndEditable -->
<!-- TemplateBeginEditable name="head" -->
<!-- TemplateEndEditable -->
</head>

<!-- Floating chatbot (all in-page) -->

<style>
#chatbot {position:fixed;bottom:80px;right:20px;width:240px;background:#fff;
border:1px solid #444;border-radius:8px;display:none;font-family:Arial;z-index:9999;}
#chatHeader {background:#333;color:#fff;padding:6px;font-weight:bold;
border-radius:8px 8px 0 0;}
#chatMessages {height:150px;overflow-y:auto;padding:6px;font-size:13px;}
#chatInputArea {padding:6px;}
#chatInput {width:70%;}
#chatToggle {position:fixed;bottom:20px;right:20px;background:#333;color:#fff;
padding:8px 12px;border-radius:50px;cursor:pointer;z-index:9999;}
</style>

<div id="chatbot">
  <div id="chatHeader">Chatbot</div>
  <div id="chatMessages"></div>
  <div id="chatInputArea">
    <input id="chatInput" type="text" />
    <button onclick="sendMsg()">Send</button>
  </div>
</div>

<div id="chatToggle" onclick="toggleChat()">Chat</div>

<script>
// Load saved chat history safely
let history = JSON.parse(localStorage.getItem("chatHistory") || "[]");

// Simple rule-based chatbot logic
function myLogic(msg) {
  msg = msg.toLowerCase();
  if (msg.includes("hello")) return "Hi there!";
  if (msg.includes("name")) return "I don't have a name yet.";
  if (msg.includes("help")) return "I can answer simple questions.";
  if (msg.includes("tell me") && (msg.includes("terence") || msg.includes("him")))
    return "What would you like to know about Terence?";
  return "I'm still learning.";
}

// Open/close the chatbot and remember the state
function toggleChat() {
  const box = document.getElementById("chatbot");
  const isOpen = box.style.display === "block";
  box.style.display = isOpen ? "none" : "block";
  localStorage.setItem("chatOpen", isOpen ? "closed" : "open");
}

// Add a message to the chat window AND save it
function addMsg(sender, text) {
  const box = document.getElementById("chatMessages");

  const line = document.createElement("div");
  line.textContent = sender + ": " + text;
  box.appendChild(line);
  box.scrollTop = box.scrollHeight;

  // Save to history in a clean format
  history.push({ sender: sender, text: text });
  localStorage.setItem("chatHistory", JSON.stringify(history));
}

// Send a message
function sendMsg() {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  addMsg("You", text);
  addMsg("Bot", myLogic(text));

  input.value = "";
}

// Restore everything on page load
window.onload = () => {
  // Restore open/closed state
  const saved = localStorage.getItem("chatOpen");
  document.getElementById("chatbot").style.display =
    saved === "open" ? "block" : "none";

  // Restore conversation history WITHOUT saving again
  const box = document.getElementById("chatMessages");

  history.forEach(m => {
    if (!m || !m.sender || !m.text) return; // skip corrupted entries
    const line = document.createElement("div");
    line.textContent = m.sender + ": " + m.text;
    box.appendChild(line);
  });
};
</script>

<body>
<table width="1100" border="0" cellspacing="0" cellpadding="3">
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>6</td>
    <td>own logic, span page no memory </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><a href="index.html">Home</a></td>
    <td><a href="setupwebpage.html">Setup Webpage</a> </td>
    <td>Setup Azure </td>
    <td>Setup Chatbot </td>
    <td>Setup Gitbub </td>
  </tr>
  <tr>
    <td colspan="5"><!-- TemplateBeginEditable name="MainContent" -->MainContent<!-- TemplateEndEditable --></td>
  </tr>
</table>
</body>
</html>
